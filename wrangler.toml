# 📄 Cloudflare Pages 配置文件 - SSR + 静态资源支持
name = "kemono-shares-api"
account_id = "9a5ff316a26b8abb696af519e515d2de"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat", "global_fetch_strictly_public"]
type = "javascript"

# ✅ 使用 @cloudflare/next-on-pages 构建命令
[build]
command = "npx @cloudflare/next-on-pages@latest"

# ✅ 设置默认构建输出目录（推荐显式声明，避免环境识别不一致）
pages_build_output_dir = "./.vercel/output/static"

# ✅ Functions 设置（动态渲染函数）
[functions]
directory = "./.vercel/output/functions"

# ✅ 生产环境配置
[env.production]
# ✅ 再次声明构建输出目录（有时环境优先级覆盖默认）
pages_build_output_dir = "./.vercel/output/static"

[env.production.vars]
NODE_ENV = "production"
NEXT_PUBLIC_APP_URL = "https://2kawaii.com"
KIE_AI_API_KEY = "2800cbec975bf014d815f4e5353c826a"
KIE_AI_API_KEY_2 = "6a77fe3ca6856170f6618d4f249cfc6a"
KIE_AI_API_KEY_3 = "db092e9551f4631136cab1b141fdfd21"
KIE_AI_API_KEY_4 = "3f06398cf9d8dc02a24c8b8b8b8b8b8b"
KIE_AI_API_KEY_5 = "c982688b5c6938943dd721ed1d576edb"

[[env.production.kv_namespaces]]
binding = "SHARE_DATA_KV"
id = "77b81f5b787b449e931fa6a51263b38c"

[[env.production.r2_buckets]]
binding = "UPLOAD_BUCKET"
bucket_name = "kemono-uploadimage"

[[env.production.r2_buckets]]
binding = "AFTERIMAGE_BUCKET"
bucket_name = "kemono-afterimage"

# ✅ 预览环境配置
[env.preview]
pages_build_output_dir = "./.vercel/output/static"

[env.preview.vars]
NODE_ENV = "development"
NEXT_PUBLIC_APP_URL = "https://dev.2kawaii.com"
KIE_AI_API_KEY = "2800cbec975bf014d815f4e5353c826a"
KIE_AI_API_KEY_2 = "6a77fe3ca6856170f6618d4f249cfc6a"
KIE_AI_API_KEY_3 = "db092e9551f4631136cab1b141fdfd21"
KIE_AI_API_KEY_4 = "3f06398cf9d8dc02a24c8b8b8b8b8b8b"
KIE_AI_API_KEY_5 = "c982688b5c6938943dd721ed1d576edb"

[[env.preview.kv_namespaces]]
binding = "SHARE_DATA_KV"
id = "2d7d8b533f3049b89d808fbb569bb09c"

[[env.preview.r2_buckets]]
binding = "UPLOAD_BUCKET"
bucket_name = "kemono-uploadimage-dev"

[[env.preview.r2_buckets]]
binding = "AFTERIMAGE_BUCKET"
bucket_name = "kemono-afterimage-dev"