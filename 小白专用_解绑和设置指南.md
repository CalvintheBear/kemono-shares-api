# 🔓 小白专用：Cloudflare 解绑和设置完整指南

## 当前状态
✅ 已移除 `wrangler.pages.toml` 中的绑定配置  
现在需要推送到 GitHub 并在控制台手动设置

---

## 📋 步骤 1: 推送更改到 GitHub（解锁控制台）

### 1.1 打开终端/命令提示符
- 按 `Win + R`，输入 `cmd`，回车
- 或者在项目文件夹右键选择"在此处打开 PowerShell 窗口"

### 1.2 推送命令（复制粘贴即可）
```bash
# 添加所有更改
git add .

# 提交更改
git commit -m "移除绑定配置以解锁控制台编辑功能"

# 推送到 GitHub
git push origin master
```

### 1.3 等待部署
- 推送完成后，GitHub 会自动触发 Cloudflare Pages 重新部署
- 等待 2-5 分钟让部署完成

---

## 🎛️ 步骤 2: 在 Cloudflare 控制台设置（现在应该可以编辑了）

### 2.1 登录 Cloudflare
1. 打开 https://dash.cloudflare.com
2. 登录你的账号
3. 找到并点击 `kemono-shares-api` 项目

### 2.2 设置构建配置
1. 点击 `Settings` （设置）
2. 点击 `Builds & deployments` （构建和部署）
3. 确认设置：
   - **构建命令**: `npm run build:pages:static`
   - **构建输出目录**: `out`
   - **根目录**: 留空（什么都不填）

### 2.3 设置环境变量
1. 在 `Settings` 页面，点击 `Environment variables` （环境变量）
2. 点击 `Add variable` （添加变量）按钮
3. 按照下面的列表，一个一个添加：

**🔑 重要变量（必须添加）：**
```
CLOUDFLARE_ACCOUNT_ID = 9a5ff316a26b8abb696af519e515d2de
CLOUDFLARE_API_TOKEN = HJ5ugyPnYiDdOjK_OjsFoZI8KgVytyIjN4GWNpZ9
CLOUDFLARE_R2_ACCESS_KEY_ID = 8072494c2581823ba4eefd7da9e910ca
CLOUDFLARE_R2_ACCOUNT_ID = 9a5ff316a26b8abb696af519e515d2de
CLOUDFLARE_R2_AFTERIMAGE_BUCKET_NAME = kemono-afterimage
CLOUDFLARE_R2_AFTERIMAGE_PUBLIC_URL = https://pub-d00e7b41917848d1a8403c984cb62880.r2.dev
CLOUDFLARE_R2_BUCKET_NAME = kemono-uploadimage
CLOUDFLARE_R2_PUBLIC_URL = https://pub-9ea5461e9e8b418caecb7e5b7748bdea.r2.dev
CLOUDFLARE_R2_SECRET_ACCESS_KEY = ee959470338a6f01c1f25fcf877e17fd3dfcca623ae6b94f6bfc8a3425b06b59
IMGBB_API_KEY = f62c400dfa7cffdbe66ebcdbf6f2d783
KIE_AI_4O_BASE_URL = https://api.kie.ai
KIE_AI_API_KEY = 2800cbec975bf014d815f4e5353c826a
KIE_AI_API_KEY_2 = 6a77fe3ca6856170f6618d4f249cfc6a
KIE_AI_API_KEY_3 = db092e9551f4631136cab1b141fdfd21
KIE_AI_API_KEY_4 = 3f06398cf9d8dc02a243f2dd5f2f9489
KIE_AI_API_KEY_5 = c982688b5c6938943dd721ed1d576edb
KIE_AI_EDGE_BASE = https://api.kie.ai/api/v1
KIE_AI_USER_ID = j2983236233@gmail.com
NEXT_PUBLIC_APP_URL = https://2kawaii.com
NODE_ENV = production
```

### 2.4 设置绑定（重要！）
1. 在 `Settings` 页面，点击 `Functions` （函数）
2. 往下滚动到 `KV namespace bindings` （KV 命名空间绑定）
3. 点击 `Add binding` （添加绑定）
4. 设置：
   - **Variable name**: `SHARE_DATA_KV`
   - **KV namespace**: 选择 `SHARE_DATA_KV` （如果没有，需要先创建）

5. 继续往下到 `R2 bucket bindings` （R2 存储桶绑定）
6. 添加第一个绑定：
   - **Variable name**: `UPLOAD_BUCKET`
   - **R2 bucket**: `kemono-uploadimage`
7. 添加第二个绑定：
   - **Variable name**: `AFTERIMAGE_BUCKET`
   - **R2 bucket**: `kemono-afterimage`

---

## 🚀 步骤 3: 触发重新部署

### 3.1 手动触发部署
1. 在 Cloudflare Pages 项目页面
2. 点击 `Deployments` （部署）
3. 点击 `Retry deployment` 或 `Create deployment` 
4. 等待部署完成（通常 2-5 分钟）

---

## ✅ 步骤 4: 验证部署

### 4.1 检查部署状态
- 在 `Deployments` 页面确认最新部署显示 "Success"

### 4.2 测试网站
- 访问 https://2kawaii.com
- 测试图片生成功能是否正常

---

## 🆘 如果遇到问题：

### 问题 1: 推送失败
```bash
# 如果推送被拒绝，尝试强制推送
git push origin master --force
```

### 问题 2: 找不到 KV 命名空间
1. 在 Cloudflare Dashboard 主页
2. 点击 `Workers & Pages`
3. 点击 `KV`
4. 点击 `Create a namespace`
5. 名称输入：`SHARE_DATA_KV`

### 问题 3: 找不到 R2 存储桶
1. 在 Cloudflare Dashboard 主页
2. 点击 `R2 Object Storage`
3. 确认存在：`kemono-uploadimage` 和 `kemono-afterimage`

### 问题 4: 部署失败
- 检查构建日志中的错误信息
- 确认所有环境变量都已正确设置

---

## 📞 完成后确认

当所有步骤完成后：
- ✅ 推送到 GitHub 成功
- ✅ 环境变量全部添加
- ✅ KV 和 R2 绑定设置完成
- ✅ 重新部署成功
- ✅ 网站 https://2kawaii.com 可以正常访问

如果所有步骤都完成了，恭喜！你已经成功恢复到存档点状态了！ 🎉
