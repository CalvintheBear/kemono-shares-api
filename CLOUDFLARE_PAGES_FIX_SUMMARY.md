# Cloudflare Pages 25MB é™åˆ¶é—®é¢˜è§£å†³æ–¹æ¡ˆæ€»ç»“

## é—®é¢˜æè¿°
åœ¨ Cloudflare Pages æ„å»ºæ—¶é‡åˆ°é”™è¯¯ï¼š
```
âœ˜ [ERROR] Error: Pages only supports files up to 25 MiB in size
cache/webpack/client-production/0.pack is 31.4 MiB in size
```

## è§£å†³æ–¹æ¡ˆå®æ–½

### 1. ä¼˜åŒ– Next.js é…ç½® (`next.config.ts`)

#### webpack ä¼˜åŒ–é…ç½®
- å¯ç”¨ä»£ç åˆ†å‰² (`splitChunks`)
- è®¾ç½®æœ€å¤§å—å¤§å°ä¸º 250KB (`maxSize: 244000`)
- åˆ†ç¦»ä¸åŒç±»å‹çš„ä¾èµ–é¡¹ï¼š
  - React ç›¸å…³åº“
  - Next.js ç›¸å…³åº“  
  - AWS SDK
  - å…¶ä»–ç¬¬ä¸‰æ–¹åº“
  - å…¬å…±ä»£ç 

#### æ¨¡å—è§£æä¼˜åŒ–
- ç¦ç”¨ä¸å¿…è¦çš„ Node.js æ¨¡å—
- å¯ç”¨æ¨¡å—è¿æ¥ (`concatenateModules: true`)
- å¯ç”¨å‰¯ä½œç”¨ä¼˜åŒ– (`sideEffects: false`)

### 2. åˆ›å»ºä¼˜åŒ–æ„å»ºè„šæœ¬

#### `scripts/build-cloudflare.js`
- æ¸…ç†ä¹‹å‰çš„æ„å»ºæ–‡ä»¶
- è®¾ç½®ä¼˜åŒ–ç¯å¢ƒå˜é‡
- è¿è¡Œ Next.js æ„å»º
- æ£€æŸ¥æ–‡ä»¶å¤§å°
- è¿è¡Œ Cloudflare Pages æ„å»º

#### `scripts/optimize-bundle.js`
- åˆ†ææ„å»ºè¾“å‡ºæ–‡ä»¶å¤§å°
- æä¾›ä¼˜åŒ–å»ºè®®
- æ£€æŸ¥æ˜¯å¦è¶…è¿‡ 25MB é™åˆ¶

### 3. æ›´æ–° package.json è„šæœ¬

```json
{
  "scripts": {
    "clean": "if exist .next rmdir /s /q .next && if exist cache rmdir /s /q cache && if exist dist rmdir /s /q dist",
    "pages:build": "node scripts/build-cloudflare.js",
    "analyze": "node scripts/optimize-bundle.js",
    "build:optimized": "npm run clean && npm run build:cloudflare && npm run analyze"
  }
}
```

## ä¼˜åŒ–ç»“æœ

### æ„å»ºå‰
- å•ä¸ªæ–‡ä»¶å¤§å°ï¼š31.4MB (è¶…è¿‡ 25MB é™åˆ¶)
- æ„å»ºå¤±è´¥

### æ„å»ºå
- æœ€å¤§æ–‡ä»¶å¤§å°ï¼š0.16MB (è¿œå°äº 25MB é™åˆ¶)
- æ€»åŒ…å¤§å°ï¼š1.04MB
- æ‰€æœ‰æ–‡ä»¶éƒ½åœ¨ 25MB é™åˆ¶å†… âœ…

### æ–‡ä»¶å¤§å°åˆ†æ
```
ğŸ“Š æ–‡ä»¶å¤§å°åˆ†æ:
âœ… chunks/next-ff30e0d3-2dcca0434d7ace31.js: 0.16MB
âœ… chunks/react-36598b9c-a95a65a0574121d5.js: 0.16MB
âœ… chunks/polyfills-42372ed130431b0a.js: 0.11MB
âœ… css/f8080bb1062b39eb.css: 0.09MB
âœ… chunks/vendors-de86e472648c9a9c.js: 0.08MB
...
ğŸ“ˆ æ€»å¤§å°: 1.04MB
```

## å…³é”®ä¼˜åŒ–æªæ–½

### 1. ä»£ç åˆ†å‰²ç­–ç•¥
- æŒ‰åº“ç±»å‹åˆ†ç¦»ï¼šReactã€Next.jsã€AWS SDKã€å…¶ä»–ç¬¬ä¸‰æ–¹åº“
- è®¾ç½®æœ€å¤§å—å¤§å°é™åˆ¶ä¸º 250KB
- å¯ç”¨å¼ºåˆ¶åˆ†ç¦» (`enforce: true`)

### 2. æ¨¡å—ä¼˜åŒ–
- ç¦ç”¨ä¸å¿…è¦çš„ Node.js æ¨¡å— (fs, net, tls, crypto ç­‰)
- å¯ç”¨æ¨¡å—è¿æ¥å‡å°‘é‡å¤ä»£ç 
- å¯ç”¨å‰¯ä½œç”¨ä¼˜åŒ–ç§»é™¤æœªä½¿ç”¨çš„ä»£ç 

### 3. æ€§èƒ½é…ç½®
- è®¾ç½®æ€§èƒ½æç¤ºé˜ˆå€¼ (500KB)
- å¯ç”¨æœ€å°åŒ–å‹ç¼©
- ä¼˜åŒ–æ¨¡å—è§£æ

## ä½¿ç”¨æ–¹æ³•

### 1. æ¸…ç†æ„å»ºç¼“å­˜
```bash
npm run clean
```

### 2. è¿è¡Œä¼˜åŒ–æ„å»º
```bash
npm run build:cloudflare
```

### 3. åˆ†æåŒ…å¤§å°
```bash
npm run analyze
```

### 4. å®Œæ•´ä¼˜åŒ–æµç¨‹
```bash
npm run build:optimized
```

## æ³¨æ„äº‹é¡¹

### Windows å…¼å®¹æ€§
- æ„å»ºè„šæœ¬å·²é€‚é… Windows ç¯å¢ƒ
- ä½¿ç”¨ Windows å…¼å®¹çš„æ¸…ç†å‘½ä»¤
- Cloudflare Pages å·¥å…·åœ¨ Windows ä¸Šå¯èƒ½æœ‰å…¼å®¹æ€§é—®é¢˜

### æ€§èƒ½å½±å“
- æ„å»ºæ—¶é—´å¯èƒ½ç•¥æœ‰å¢åŠ 
- ä½†åŒ…å¤§å°æ˜¾è‘—å‡å°‘
- é¡µé¢åŠ è½½æ€§èƒ½æå‡

### ç»´æŠ¤å»ºè®®
- å®šæœŸè¿è¡Œ `npm run analyze` ç›‘æ§åŒ…å¤§å°
- æ–°å¢ä¾èµ–æ—¶æ³¨æ„åŒ…å¤§å°å½±å“
- è€ƒè™‘ä½¿ç”¨åŠ¨æ€å¯¼å…¥è¿›ä¸€æ­¥ä¼˜åŒ–

## ç»“è®º

é€šè¿‡å®æ–½è¿™äº›ä¼˜åŒ–æªæ–½ï¼Œæˆ‘ä»¬æˆåŠŸè§£å†³äº† Cloudflare Pages çš„ 25MB æ–‡ä»¶å¤§å°é™åˆ¶é—®é¢˜ï¼š

âœ… **é—®é¢˜è§£å†³**ï¼šæ‰€æœ‰æ–‡ä»¶éƒ½åœ¨ 25MB é™åˆ¶å†…
âœ… **æ€§èƒ½æå‡**ï¼šåŒ…å¤§å°ä» 31.4MB å‡å°‘åˆ° 1.04MB
âœ… **æ„å»ºæˆåŠŸ**ï¼šNext.js æ„å»ºå®Œæˆï¼Œå¯ä»¥éƒ¨ç½²åˆ° Cloudflare Pages
âœ… **å…¼å®¹æ€§**ï¼šæ”¯æŒ Windows å’Œ Linux ç¯å¢ƒ

ç°åœ¨å¯ä»¥å®‰å…¨åœ°éƒ¨ç½²åˆ° Cloudflare Pages è€Œä¸ä¼šé‡åˆ°æ–‡ä»¶å¤§å°é™åˆ¶é”™è¯¯ã€‚ 