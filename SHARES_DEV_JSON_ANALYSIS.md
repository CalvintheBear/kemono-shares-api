# shares-dev.json æ–‡ä»¶æ ¼å¼ä¸ä½¿ç”¨åˆ†æ

## ğŸ“ æ–‡ä»¶æ¦‚è¿°

`shares-dev.json` æ˜¯furycodeé¡¹ç›®ä¸­çš„æœ¬åœ°å¼€å‘æ•°æ®å­˜å‚¨æ–‡ä»¶ï¼Œç”¨äºåœ¨å¼€å‘ç¯å¢ƒä¸­æŒä¹…åŒ–åˆ†äº«æ•°æ®ã€‚

**æ–‡ä»¶è·¯å¾„**: `local-storage/shares-dev.json`

## ğŸ—ï¸ æ•°æ®ç»“æ„

### æ ¹ç»“æ„
```json
{
  "share_id_1": { ShareData },
  "share_id_2": { ShareData },
  ...
}
```

### ShareData æ¥å£å®šä¹‰
```typescript
interface ShareData {
  id: string                    // åˆ†äº«IDï¼Œæ ¼å¼: share_timestamp_random
  generatedUrl: string          // ç”Ÿæˆçš„å›¾ç‰‡URL
  originalUrl: string | null    // åŸå›¾URLï¼ˆå›¾ç”Ÿå›¾æ¨¡å¼ï¼‰æˆ–nullï¼ˆæ–‡ç”Ÿå›¾æ¨¡å¼ï¼‰
  prompt: string               // ç”Ÿæˆæç¤ºè¯
  style: string                // é£æ ¼ç±»å‹
  timestamp: number            // æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
  createdAt: string            // åˆ›å»ºæ—¶é—´ï¼ˆISOæ ¼å¼ï¼‰
  isR2Stored?: boolean         // æ˜¯å¦å­˜å‚¨åœ¨R2
  isTextToImage?: boolean      // æ˜¯å¦ä¸ºæ–‡ç”Ÿå›¾æ¨¡å¼
}
```

### ç¤ºä¾‹æ•°æ®
```json
{
  "share_1753692251015_feybsyqle": {
    "id": "share_1753692251015_feybsyqle",
    "generatedUrl": "https://pub-d00e7b41917848d1a8403c984cb62880.r2.dev/kie-downloads/share-ã‚«ã‚¹ã‚¿ãƒ -1753692246929.png",
    "originalUrl": null,
    "prompt": "ã¡ã³ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã€Qç‰ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒ¡ã€å¯æ„›ã‚‰ã—ã„å°ã•ãªä½“ã€å¤§ããªé ­ã€ãµã‚ãµã‚ã—ãŸé›°å›²æ°—ã€ç™’ã—ç³»",
    "style": "ã‚«ã‚¹ã‚¿ãƒ ",
    "timestamp": 1753692246929,
    "createdAt": "2025-07-28T08:44:11.015Z",
    "isR2Stored": true,
    "isTextToImage": true
  }
}
```

## ğŸ”— å¼•ç”¨å…³ç³»

### 1. æ ¸å¿ƒå­˜å‚¨æ¨¡å—
**æ–‡ä»¶**: `src/lib/share-store-kv.ts`

#### è¯»å–å‡½æ•°
```typescript
function readDevJson(): Record<string, ShareData> {
  try {
    if (fs.existsSync(DEV_JSON_PATH)) {
      const raw = fs.readFileSync(DEV_JSON_PATH, 'utf-8')
      return JSON.parse(raw)
    }
  } catch (e) {
    console.warn('âš ï¸ è¯»å–æœ¬åœ°æŒä¹…åŒ–åˆ†äº«æ•°æ®å¤±è´¥:', e)
  }
  return {}
}
```

#### å†™å…¥å‡½æ•°
```typescript
function writeDevJson(data: Record<string, ShareData>) {
  try {
    fs.writeFileSync(DEV_JSON_PATH, JSON.stringify(data, null, 2), 'utf-8')
    console.log('ğŸ’¾ å·²å†™å…¥æœ¬åœ°æŒä¹…åŒ–åˆ†äº«æ•°æ®:', DEV_JSON_PATH)
  } catch (e) {
    console.warn('âš ï¸ å†™å…¥æœ¬åœ°æŒä¹…åŒ–åˆ†äº«æ•°æ®å¤±è´¥:', e)
  }
}
```

#### ä½¿ç”¨åœºæ™¯
- **getAll()**: ä»JSONæ–‡ä»¶åŠ è½½æ‰€æœ‰åˆ†äº«æ•°æ®
- **set()**: ä¿å­˜æ–°æ•°æ®åˆ°JSONæ–‡ä»¶
- **delete()**: ä»JSONæ–‡ä»¶åˆ é™¤æ•°æ®
- **get()**: ä»JSONæ–‡ä»¶è·å–å•ä¸ªåˆ†äº«æ•°æ®

### 2. æ•°æ®ä¿®å¤è„šæœ¬
**æ–‡ä»¶**: `fix-old-share-data.js`, `fix-old-share-data-v2.js`
- ç”¨äºä¿®å¤å†å²æ•°æ®ä¸­çš„æ ¼å¼é—®é¢˜
- æ›´æ–° `isTextToImage` å­—æ®µ
- æ¸…ç†æ— æ•ˆæ•°æ®

### 3. è°ƒè¯•å·¥å…·
**æ–‡ä»¶**: `debug-share-types.js`, `check-share-data.js`
- åˆ†ææ•°æ®åˆ†å¸ƒ
- éªŒè¯æ•°æ®å®Œæ•´æ€§
- ç»Ÿè®¡æ–‡ç”Ÿå›¾vså›¾ç”Ÿå›¾æ¯”ä¾‹

### 4. æµ‹è¯•è„šæœ¬
**æ–‡ä»¶**: `test-share-fix.js`
- æµ‹è¯•æ•°æ®ä¿®å¤åŠŸèƒ½
- éªŒè¯ç­›é€‰é€»è¾‘

## ğŸ”„ æ•°æ®æµç¨‹

### å¼€å‘ç¯å¢ƒæ•°æ®æµ
```
ç”¨æˆ·æ“ä½œ â†’ å†…å­˜ç¼“å­˜ â†’ shares-dev.json â†’ æŒä¹…åŒ–å­˜å‚¨
    â†‘                                    â†“
    â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ è¯»å–æ•°æ® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç”Ÿäº§ç¯å¢ƒæ•°æ®æµ
```
ç”¨æˆ·æ“ä½œ â†’ å†…å­˜ç¼“å­˜ â†’ Cloudflare KV â†’ æŒä¹…åŒ–å­˜å‚¨
    â†‘                                    â†“
    â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ è¯»å–æ•°æ® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š æ•°æ®ç»Ÿè®¡

### å½“å‰æ•°æ®åˆ†å¸ƒ
- **æ€»è®°å½•æ•°**: çº¦60+æ¡
- **æ–‡ç”Ÿå›¾æ¨¡å¼**: `isTextToImage: true` (originalUrlä¸ºnull)
- **å›¾ç”Ÿå›¾æ¨¡å¼**: `isTextToImage: false` (originalUrlæœ‰å€¼)
- **æ¨¡æ¿æ¨¡å¼**: ç‰¹æ®Šå›¾ç”Ÿå›¾ï¼ŒoriginalUrlåŒ…å«placeholder

### é£æ ¼ç±»å‹åˆ†å¸ƒ
- ã‚«ã‚¹ã‚¿ãƒ  (è‡ªå®šä¹‰)
- irasutoya (æ’ç”»å±‹)
- æ“¬äººåŒ– (æ‹ŸäººåŒ–)
- ã‚¦ãƒå¨˜ (èµ›é©¬å¨˜)
- åŸç¥ç•°ä¸–ç•Œ (åŸç¥å¼‚ä¸–ç•Œ)
- LINEã‚¹ã‚¿ãƒ³ãƒ— (LINEè´´çº¸)
- ãƒ¤ãƒ³ãƒ‡ãƒ¬&åœ°é›·å¥³ (ç—…å¨‡&åœ°é›·å¥³)

## ğŸ› ï¸ ç»´æŠ¤æ“ä½œ

### æ•°æ®æ¸…ç†
```bash
# æ¸…ç†è¿‡æœŸæ•°æ®ï¼ˆ30å¤©å‰ï¼‰
node scripts/cleanup-old-data.js

# ä¿®å¤æ•°æ®æ ¼å¼
node fix-old-share-data.js
```

### æ•°æ®éªŒè¯
```bash
# æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
node check-share-data.js

# åˆ†ææ•°æ®ç±»å‹åˆ†å¸ƒ
node debug-share-types.js
```

### æ•°æ®å¤‡ä»½
```bash
# å¤‡ä»½å½“å‰æ•°æ®
cp local-storage/shares-dev.json local-storage/shares-dev-backup.json
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ•°æ®ä¸€è‡´æ€§
- ç¡®ä¿ `id` å­—æ®µä¸å¯¹è±¡é”®åä¸€è‡´
- éªŒè¯ `timestamp` å’Œ `createdAt` çš„æ—¶é—´ä¸€è‡´æ€§
- æ£€æŸ¥ `isTextToImage` å­—æ®µçš„å‡†ç¡®æ€§

### 2. æ–‡ä»¶å¤§å°
- å½“å‰æ–‡ä»¶çº¦687è¡Œï¼ŒåŒ…å«60+æ¡è®°å½•
- å»ºè®®å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®
- ç›‘æ§æ–‡ä»¶å¤§å°å¢é•¿

### 3. å¼€å‘ç¯å¢ƒé™åˆ¶
- ä»…åœ¨ `NODE_ENV === 'development'` æ—¶ä½¿ç”¨
- ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Cloudflare KV å­˜å‚¨
- æœ¬åœ°æ–‡ä»¶ä½œä¸ºå¼€å‘æ—¶çš„æ•°æ®å¤‡ä»½

## ğŸ”® æœªæ¥ä¼˜åŒ–

### 1. æ•°æ®å‹ç¼©
- è€ƒè™‘ä½¿ç”¨å‹ç¼©æ ¼å¼å‡å°‘æ–‡ä»¶å¤§å°
- å®ç°å¢é‡å¤‡ä»½æœºåˆ¶

### 2. æ•°æ®éªŒè¯
- æ·»åŠ æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
- å®ç°è‡ªåŠ¨æ•°æ®ä¿®å¤

### 3. æ€§èƒ½ä¼˜åŒ–
- å®ç°æ•°æ®åˆ†ç‰‡å­˜å‚¨
- æ·»åŠ æ•°æ®ç´¢å¼•æœºåˆ¶

---

*åˆ†ææ—¶é—´: 2025-07-28*
*æ•°æ®ç‰ˆæœ¬: v1.0* 